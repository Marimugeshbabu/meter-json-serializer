#include <Arduino.h>
#include <string.h>
#include "data_model.h"
#include "json_serializer.h"

GatewayData gateway;
char json_output[512];

void setup() {
    Serial.begin(9600);

    strcpy(gateway.gatewayId, "gateway_1234");
    strcpy(gateway.date, "1970-01-01");
    strcpy(gateway.deviceType, "stromleser");
    gateway.interval_minutes = 15;
    gateway.total_readings = 1;

    gateway.values.device_count = 1;

    strcpy(gateway.values.readings[0].media, "water");
    strcpy(gateway.values.readings[0].meter, "waterstarm");
    strcpy(gateway.values.readings[0].deviceId, "stromleser_50898527");
    strcpy(gateway.values.readings[0].unit, "m3");

    gateway.values.readings[0].data_count = 1;
    strcpy(gateway.values.readings[0].data[0].timestamp, "1970-01-01 00:00");
    strcpy(gateway.values.readings[0].data[0].meter_datetime, "1970-01-01 00:00");
    gateway.values.readings[0].data[0].total_m3 = 107.752;
    strcpy(gateway.values.readings[0].data[0].status, "OK");

    int result = serialize_to_json(&gateway, json_output, sizeof(json_output));

    if (result > 0) {
        Serial.println(json_output);
    } else {
        Serial.println("Error generating JSON");
    }
}

void loop() {}
